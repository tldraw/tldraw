name = "fairydraw"
main = "src/worker.ts"
compatibility_date = "2024-12-30"

[dev]
port = 8789

[observability]
enabled = true

[env.dev]
name = "fairydraw-dev"

[env.staging]
name = "fairydraw-staging"
route = { pattern = "staging-agent.tldraw.xyz", custom_domain = true }

[env.production]
name = "fairydraw"
route = { pattern = "agent.tldraw.xyz", custom_domain = true }

#################### Durable Objects ####################
# Durable objects require migrations to create/modify/delete them
[[migrations]]
tag = "v1"
new_classes = ["TldrawAiDurableObject"]

[[migrations]]
tag = "v2"
renamed_classes = [
    { from = "TldrawAiDurableObject", to = "AgentDurableObject" },
]

# Durable objects have the same configuration in all environments
[env.dev.durable_objects]
bindings = [
    { name = "AGENT_DURABLE_OBJECT", class_name = "AgentDurableObject" },
]

[durable_objects]
bindings = [
    { name = "AGENT_DURABLE_OBJECT", class_name = "AgentDurableObject" },
]

[env.staging.durable_objects]
bindings = [
    { name = "AGENT_DURABLE_OBJECT", class_name = "AgentDurableObject" },
]

[env.production.durable_objects]
bindings = [
    { name = "AGENT_DURABLE_OBJECT", class_name = "AgentDurableObject" },
]

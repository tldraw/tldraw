---
title: Sync
status: published
author: alex
date: 7/11/2024
order: 6
keywords:
  - data
  - sync
  - persistence
  - database
  - multiplayer
  - collaboration
  - server
  - websockets
---

Realtime multi-user collaboration on a tldraw canvas is possible using **tldraw sync**, an add-on library for tldraw. You can also integrate another sync engine, or your own custom sync layer, using tldraw's sync hooks.

## tldraw sync

tldraw sync is a library for fast, multiuser collaboration. It's purpose-built for the tldraw canvas, and is in use on our flagship app tldraw.com to power the shared whiteboards there.

<div className="article__image" style={{ border: 'none' }}>
	<img
		alt="Multiplayer example using tldraw sync"
		src="/images/multiplayer.gif"
		style={{
			// learn this one weird trick for transparent animated gifs. doctors hate her!!!
			mask: 'url(/images/multiplayer_mask.png) luminance center 100% / 100% no-repeat',
			WebkitMask: 'url(/images/multiplayer_mask.png) luminance center 100% / 100% no-repeat',
		}}
	/>
</div>

## Try the demo server

The easiest way to experiment with multiplayer is by using our demo server. To get started, install
`@tldraw/sync`:

```bash
npm install @tldraw/sync
```

Then call the `useSyncDemo` React hook, passing in a room ID. It returns a
[`store`](/docs/persistence#The-store-prop) that you can pass into the `<Tldraw />` component:

```tsx
import { Tldraw } from 'tldraw'
import { useSyncDemo } from '@tldraw/sync'

function MyApp() {
	const store = useSyncDemo({ roomId: 'myApp-abc123' })
	return <Tldraw store={store} />
}
```

> ðŸ’¡ Make sure that `roomId` is unique. Anyone who uses the same ID can access your room.

Data on the demo server only lasts for up to 24 hours. This is great for testing, but for production use you'll need to host your own server.

## Self-host the backend

There are two main ways to go about hosting your own backend for tldraw sync:

1. Deploy a full backend to Cloudflare using our template (recommended).
2. Integrate tldraw sync into your own JavaScript backend, using our examples and docs as a guide.

### Use our Cloudflare template

The best way to get started hosting your own backend is by [cloning and deploying our Cloudflare template](https://github.com/tldraw/cloudlfare-workers-template).

The template provides a production-grade minimal setup of the system that runs on tldraw.com, powering multiplayer collaboration and data persistence for hundreds of thousands of users.

It uses:

- [Durable Objects](https://developers.cloudflare.com/durable-objects/) to provide a WebSocket server per room.
- [R2](https://developers.cloudflare.com/r2/) to store assets and room data.

There are some features that we have not provided, and you might want to add yourself:

- Authentication and authorization.
- Rate limiting and size limiting for asset uploads.
- Storing snapshots of documents over time for long-term history.
- Listing and searching for rooms.

Make sure you also read the section below about [deployment concerns](#deployment_concerns).

### Integrate tldraw sync into your own backend

The `@tldraw/sync-core` library can be used to integrate tldraw sync into any JavaScript server environment that supports WebSockets.

We have a [simple server example](https://github.com/tldraw/tldraw/tree/main/apps/simple-server-example), supporting both NodeJS and Bun, to use as a reference for how things should be stitched together.

#### Backend anatomy

A backend for tldraw sync consists of two or three parts:

- A **WebSocket server** that provides rooms for each shared document.
- An **asset storage** provider for large binary files like images and videos.
- (If using the built-in bookmark shape) An **unfurling service** to extract metadata about bookmark URLs.

On the frontend, there is just one part: the **sync client**, created using the [`useSync`](?) hook from the `@tldraw/sync` package.

Pulling all four of these together, here's what a simple client implementation might look like:

```tsx
import { Tldraw, TLAssetStore, Editor } from 'tldraw'
import { useSync } from '@tldraw/sync'
import { uploadFileAndReturnUrl } from './assets'
import { convertUrlToBookmarkAsset } from './unfurl'

function MyEditorComponent({myRoomId}) {
	// This hook creates a sync client that manages the websocket connection to the server
	// and coordinates updates to the document state.
	const store = useSync({
		// This is how you tell the sync client which server and room to connect to
		uri: `wss://my-custom-backend.com/connect/${myRoomId}`,
		// This is how you tell the sync client how to store and retrieve blobs
		assets: myAssetStore,
	})
	// When the tldraw Editor mounts, you can register an asset handler for the bookmark URLs
	return <Tldraw store={store} onMount={registerUrlHandler} />
}

const myAssetStore: TLAssetStore {
	upload(file, asset) {
		return uploadFileAndReturnUrl(file)
	},
	resolve(asset) {
		return asset.props.src
	},
}

function registerUrlHandler(editor: Editor) {
	editor.registerExternalAssetHandler('url', async ({url}) => {
		return await convertUrlToBookmarkAsset(url)
	})
}
```

And [here's an actual working example](https://github.com/tldraw/tldraw/blob/main/apps/simple-server-example/src/client/App.tsx).

#### WebSocket server

The `@tldraw/sync-core` package exports a class called [`TLSocketRoom`](?) that should be created server-side on a per-document basis. It is used to

- Store an authoritative in-memory copy of the document state
- Transparently set up communication between multiple sync clients via WebSockets.
- Provide notifications for when the document state changes so that persistent storage can be updated.

> :bulb: You should make sure that there's only ever one `TLSocketRoom` globally for each room in your app. If there's
> more than one, users won't see each other and will overwrite others' changes. We use [Durable
> Objects](https://developers.cloudflare.com/durable-objects/) to achieve this on tldraw.com.

Read the reference docs for [`TLSocketRoom`](?), and see an example of how to use it in the [simple server example](https://github.com/tldraw/tldraw/blob/main/apps/simple-server-example/src/server/rooms.ts).

#### Asset storage

As well as synchronizing the rapidly-changing document data, tldraw also needs a way to store and
retrieve large binary assets like images or videos.

You'll need to make sure your backend can handle asset uploads & downloads, then implement
[`TLAssetStore`](?) to connect it to tldraw.

- Read about [how assets work in tldraw](/docs/assets).
- Read the [`TLAssetStore`](?) reference docs.
- See a complete example of an asset store in the
  [`tldraw-sync-cloudflare`](https://github.com/tldraw/tldraw/blob/main/templates/sync-cloudflare/client/multiplayerAssetStore.tsx)
  template.

#### Unfurling service

If you want to use the built-in bookmark shape, you'll need to use or implement an unfurling service that returns metadata about URLs.

This should be registered with the [`Editor`](?) when it loads.

```tsx
<Tldraw
	store={store}
	onMount={(editor) => {
		editor.registerExternalAssetHandler('url', unfurlBookmarkUrl)
	}}
/>
```

Refer to the simple server example for example [client](https://github.com/tldraw/tldraw/blob/main/apps/simple-server-example/src/client/App.tsx) and [server](https://github.com/tldraw/tldraw/blob/main/apps/simple-server-example/src/server/unfurl.ts) code.

### Deployment concerns

> ðŸ’¡ You must make sure that the tldraw version in your client matches the version on the server.
> We don't guarantee server backwards compatibility forever, and very occasionally we might release a version
> where the backend cannot meaningfully support older clients, in which case tldraw will display a "please refresh the page" message.
> So you should make sure that the backend is updated at the same time as the client, and that the new backend is up and running just before the new client rolls out.

## Roll your own sync engine

While tldraw sync is the easiest way to add sync capabilities to your tldraw canvas, we expose low-level persistence and multiplayer APIs so that you can

- Build your own sync engine for tldraw
- Connect an off-the-shelf sync engine to tldraw

Refer to the [Persistence docs](/docs/persistence) to learn about these lower-level APIs.

One example of this in practice is the [Yjs integration](https://github.com/tldraw/tldraw-yjs-example) (not production ready, use only as a guide).
